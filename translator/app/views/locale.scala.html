@(project: models.Project, locale: models.Locale, locales: List[models.Locale])

@main(Messages("locale", project.name, tags.locale(locale))) {
	<li>
		<a href="@routes.ApplicationController.project(locale.project.id)">
			<span class="glyphicon glyphicon-globe" aria-hidden="true"></span>
			@Messages("project", project.name)
		</a>
	</li>
	<li class="dropdown">
		<a class="dropdown-toggle" data-toggle="dropdown" href="#">
			<span class="glyphicon glyphicon-transfer" aria-hidden="true"></span>
			@tags.locale(locale)
			<i class="fa fa-caret-down"></i>
		</a>
		<ul class="dropdown-menu dropdown-messages">
			@for(l <- locales) {
	            <li>
	                <a href="@routes.ApplicationController.locale(l.id)">
						@tags.locale(l)
	                </a>
	            </li>
			}
        </ul>
	</li>
} {
@tags.threeColumns {
	<div class="list-group">
		@if(!project.keys.isEmpty) {
		<div class="list-group-item sidebar-search">
			<form id="form-search">
				<div class="custom-search-form">
					<input id="field-search" type="text" class="form-control" placeholder="Search...">
				</div> <!-- /input-group -->
				<input type="submit" class="hidden" />
			</form>
		</div>
		}
		@for(key <- project.keys) {
			<a href="#key=@key.name" class="list-group-item key" id="@key.id" name="@key.name">
				<h4 class="list-group-item-heading name">@key.name</h4>
				<p class="list-group-item-text value">@key.messageValue(locale)</p>
			</a>
		}
	</div>
} {
	<div id="no-selection" class="center-container">
		<span class="center">@Messages("key.selection.none")</span>
	</div>
	<form id="form-message">
		<input id="field-id" type="hidden" />
		<input id="field-keyId" type="hidden" />
		<div class="form-group">
			<label for="field-locale-to">@Messages("locale.to.label")</label>
			<select id="field-locale-to" class="form-control">
				@for(l <- locales) {
					<option value="@l.id">@tags.locale(l)</option>
				}
			</select>
		</div>
		<div class="form-group">
			<label>@Messages("locale.preview")</label>
			<div id="preview"></div>
		</div>
		<div class="form-group hidden">
			<label for="field-key">@Messages("locale.key.label")</label>
			<input id="field-key" class="form-control" type="text" disabled="disabled" />
		</div>
		<div class="form-group">
			<label for="field-value">@Messages("locale.value.label")</label>
			<textarea id="field-value" class="form-control" rows="3"></textarea>
		</div>
		<button id="submit" class="btn btn-default">@Messages("button.submit")</button>
	</form>
} {
}

<button type="button" id="create" class="btn btn-circle btn-raised btn-primary">
	<span class="glyphicon glyphicon-plus"></span>
</button>

<script>
function updateForm(keyId, keyName) {
	$("#no-selection").hide();
	$("#form-message").show();
    $('#field-id').val('');
	$('#field-key').val(keyName).attr('keyId', keyId);
    $('#field-value').val('');
    $('#preview').html('');
	$.ajax(
		jsRoutes.controllers.ApiController.getMessage($('#field-locale-to').val(), keyName)
	).done(function(data) {
	    if (console && console.log) {
			console.log('Message: ', data);
		}
	    $('#field-id').val(data.id);
	    $('#field-key').val(data.key.name).attr('keyId', data.key.id);
	    $('#field-value').val(data.value);
	    $('#preview').html(data.value);
	});
}
$(document).ready(function() {
	$("#form-message").hide();
	$('#form-search').submit(function(e) {
		console.log('Hide...');
        e.preventDefault();
        var value = $('#field-search').val();
        if(value !== '') {
			$('a.key').hide();
			$('a.key[name*=' + $('#field-search').val() +']').show();
        } else {
        	$('a.key').show();
        }
	});
	$("#form-message").submit(function(e){
        e.preventDefault();
		$.ajax(
			$.extend(
				jsRoutes.controllers.ApiController.putMessage(),
				{
					contentType: 'application/json',
					dataType: 'json',
					data: JSON.stringify({
						"id": $('#field-id').val() !== '' ? $('#field-id').val() : null,
						"locale": {
						  "id": $('#field-locale-to').val()
						},
						"key": {
							"id": $('#field-key').attr('keyId')
						},
						"value": $('#field-value').val()
					})
				}
			)
		).done(function(data) {
		    if (console && console.log) {
				console.log('Updated: ', data);
			}
		    if(data.locale.id === '@locale.id') {
		    	$('#' + data.key.id + ' .value').html(data.value);
		    }
		});
    });
	$('a.key').click(function() {
		$('a.key').removeClass('active');
		$(this).addClass('active')
		updateForm($(this).attr('id'), $(this).attr('name'));
	})
	$('#field-locale-from').change(function() {
		window.location.href=jsRoutes.controllers.ApplicationController.locale($('#field-locale-from').val()).url + '#key=' + $('#field-key').val();
	});
	$('#field-locale-to').change(function() {
		updateForm($('#field-key').attr('keyId'), $('#field-key').val());
	});
	$('#field-value').on('change keyup paste', function() {
	    $('#preview').html($('#field-value').val());
	});

	var hash = window.location.hash;
	if(hash !== '') {
		console.log('Hash: ', hash);
		var keyName = hash.replace('#key=', '');
		$('a.key[name="'+keyName+'"]').click();
	}
});
</script>
}
