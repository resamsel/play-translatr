<div class="container">
  <div>
    <entity-table
      [dataSource]="accessTokens$ | async"
      [displayedColumns]="displayedColumns"
      [load]="load$ | async"
      (criteria)="onCriteriaChanged($event)"
      (selected)="onSelected($event)">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let element">{{element.name}}</td>
      </ng-container>

      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef>User</th>
        <td mat-cell *matCellDef="let element">
          <a class="link" href="/ui/{{element.userUsername}}">{{element.userName}}</a>
        </td>
      </ng-container>

      <ng-container matColumnDef="scopes">
        <th mat-header-cell *matHeaderCellDef>Scope</th>
        <td mat-cell *matCellDef="let element">{{element.scope.split(',').slice(0, 4).join(', ')}}<span
          *ngIf="element.scope.split(',').length > 4">, ...</span></td>
      </ng-container>

      <ng-container matColumnDef="when_created">
        <th mat-header-cell *matHeaderCellDef>Created</th>
        <td mat-cell *matCellDef="let element"
            [title]="element.whenCreated | date:'full'">{{element.whenCreated | amTimeAgo}}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="actions">Actions</th>
        <td mat-cell *matCellDef="let element" class="actions">
          <button
            mat-icon-button
            title="Edit"
            [disabled]="!(allowEdit$(element) | async)"
            (click)="onEdit(element)">
            <mat-icon>edit</mat-icon>
          </button>
          <confirm-button
            title="Delete"
            icon="delete"
            [disabled]="!(allowDelete$(element) | async)"
            (confirm)="onDelete(element)">
          </confirm-button>
        </td>
      </ng-container>

      <selection-actions>
        <confirm-button
          title="Delete selected"
          icon="delete"
          [disabled]="!(allowDeleteAll$(selected) | async)"
          (confirm)="onDeleteAll(selected)"></confirm-button>
      </selection-actions>
    </entity-table>
  </div>
</div>
