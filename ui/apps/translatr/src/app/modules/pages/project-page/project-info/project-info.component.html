<div class="container flex" *ngIf="project$ | async as project">
  <dev-metric
    [routerLink]="['/', project.ownerUsername]"
    name="Owner"
    [value]="project.ownerName"
    icon="account_circle"
    class="owner"></dev-metric>

  <dev-metric
    routerLink="locales"
    name="Languages"
    [value]="(locales$ | async)?.total | shortNumber"
    icon="language"
    class="locale count"></dev-metric>

  <dev-metric
    routerLink="keys"
    name="Keys"
    [value]="(keys$ | async)?.total | shortNumber"
    icon="vpn_key"
    class="key count"></dev-metric>

  <dev-metric
    routerLink="members"
    name="Members"
    [value]="(members$ | async)?.total | shortNumber"
    icon="group"
    class="member count"></dev-metric>

  <mat-card class="metric locales">
    <mat-card-header>
      <mat-card-title i18n="@@locales.latest">Recent Languages</mat-card-title>
      <mat-card-subtitle>Latest additions to this projects' languages.</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <app-nav-list
        [empty]="localesEmpty"
        [loadingListLength]="3"
        [pagedList]="latestLocales$ | async"
        [showMore]="false"
        loadingIcon="language"
      >
        <a *ngFor="let locale of (latestLocales$ | async)?.list"
           mat-list-item
           [routerLink]="['locales', locale.name]">
          <mat-icon matListIcon class="locale circle">language</mat-icon>
          <h3 matLine>{{ locale.displayName }} <span class="sub-title">{{ locale.name }}</span></h3>
          <mat-progress-bar
            *ngIf="locale.progress !== undefined"
            mode="determinate"
            color="accent"
            [value]="locale.progress * 100"
            matTooltip="{{locale.progress * 100 | number:'1.0-1'}}% translated"
            i18n-matTooltip="@@locale.progress.tooltip"
            matLine
          ></mat-progress-bar>
        </a>
      </app-nav-list>
      <ng-template #localesEmpty>
        <div class="empty">
          <mat-icon class="locale circle">language</mat-icon>
          <h3>No languages yet.</h3>
          <button
            *ngIf="canCreateLocale$ | async"
            (click)="openLocaleCreationDialog(project)"
            i18n="@@locale.create"
            mat-stroked-button>Add language
          </button>
        </div>
      </ng-template>
    </mat-card-content>
  </mat-card>

  <mat-card class="metric keys">
    <mat-card-header>
      <mat-card-title i18n="@@keys.latest">Recent Keys</mat-card-title>
      <mat-card-subtitle>Latest additions to this projects' keys.</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <app-nav-list
        [empty]="keysEmpty"
        [loadingListLength]="3"
        [pagedList]="latestKeys$ | async"
        [showMore]="false"
        loadingIcon="vpn_key"
      >
        <a *ngFor="let key of (latestKeys$ | async)?.list"
           mat-list-item
           [routerLink]="['keys', key.name]">
          <mat-icon matListIcon class="key circle">vpn_key</mat-icon>
          <h3 matLine>{{ key.name }}</h3>
          <mat-progress-bar
            *ngIf="key.progress !== undefined"
            mode="determinate"
            color="accent"
            [value]="key.progress * 100"
            matTooltip="{{key.progress * 100 | number:'1.0-1'}}% translated"
            i18n-matTooltip="@@key.progress.tooltip"
            matLine
          ></mat-progress-bar>
        </a>
      </app-nav-list>
      <ng-template #keysEmpty>
        <div class="empty">
          <mat-icon class="key circle">vpn_key</mat-icon>
          <h3>No keys yet.</h3>
          <button
            *ngIf="canCreateKey$ | async"
            (click)="openKeyCreationDialog(project)"
            i18n="@@key.create"
            mat-stroked-button>Add key
          </button>
        </div>
      </ng-template>
    </mat-card-content>
  </mat-card>

  <mat-card class="metric messages">
    <mat-card-header>
      <mat-card-title i18n="@@translations.latest">Recent Translations</mat-card-title>
      <mat-card-subtitle>Latest translations of this project.</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <app-nav-list
        [empty]="messagesEmpty"
        [loadingListLength]="3"
        [pagedList]="latestMessages$ | async"
        [showMore]="false"
        loadingIcon="message"
      >
        <a *ngFor="let message of (latestMessages$ | async)?.list"
           [queryParams]="{locale: message.localeName}"
           [routerLink]="['keys', message.keyName]"
           mat-list-item>
          <mat-icon class="message circle" matListIcon>message</mat-icon>
          <h3 matLine>{{ message.keyName }} <span class="sub-title">{{ message.localeDisplayName }}</span></h3>
          <p matLine i18n="@@message.wordCount">{{message.wordCount}} words</p>
        </a>
      </app-nav-list>
      <ng-template #messagesEmpty>
        <div class="empty">
          <mat-icon class="message circle">language</mat-icon>
          <h3 i18n="@@messages.empty">No translations yet.</h3>
        </div>
      </ng-template>
    </mat-card-content>
  </mat-card>

  <mat-card *featureFlag="Feature.ProjectCliCard">
    <mat-card-header>
      <mat-card-title i18n="@@cli.integration.title">CLI Integration</mat-card-title>
      <mat-card-subtitle i18n="@@cli.integration.subtitle"
      >Sample <strong>.translatr.yml</strong> file to be used with the Translatr CLI.
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field appearance="outline">
        <mat-label>File type</mat-label>
        <mat-select [(value)]="fileType">
          <mat-option [value]="FileType.PlayMessages">Play messages</mat-option>
          <mat-option [value]="FileType.JavaProperties">Java properties</mat-option>
          <mat-option [value]="FileType.Gettext">Gettext (PO)</mat-option>
          <mat-option [value]="FileType.Json">JSON</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Access token</mat-label>
        <mat-select [(value)]="accessTokenKey">
          <mat-option value="${TRANSLATR_ACCESS_TOKEN}">From environment (secure)</mat-option>
          <mat-option
            *ngFor="let accessToken of accessTokens$ | async"
            value="{{accessToken.key}}"
          >{{accessToken.name}}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- @formatter:off -->
      <pre class="language-yml"><code>translatr:
  endpoint: {{endpointUrl}}
  project_id: {{project.id}}
  access_token: {{accessTokenKey}}
  pull:
    file_type: {{fileType}}
    target: {{targets[fileType]}}
  push:
    file_type: {{fileType}}
    target: {{targets[fileType]}}</code></pre>
      <!-- @formatter:on -->
    </mat-card-content>
  </mat-card>

  <section>
    <h2>Activity</h2>
    <app-activity-list
      [activities]="activities$ | async"
      [showMore]="false"
      relativeTo="project"
    ></app-activity-list>
  </section>

  <div></div>
</div>
